package com.mylearn.threadlocal.demo1;

import java.util.Random;

/**
 * Created by IntelliJ IDEA.
 * User: yingkh
 * Date: 13-2-19
 * Time: ????10:03
 * CopyRight:360buy
 * Descrption:
 *  ThreadLocal??¨®????????????????????????????????ThreadLocal???????????????????????????
 *  ?????????4??????????????????????—¨???????????????????4?????????????????????????????????
 *  ThreadLocal?????????????????????Object?????ThreadLocal??????synchronized?????
 *
 * To change this template use File | Settings | File Templates.
 */
public class TheadLocalTest implements Runnable {

    private ThreadLocal<Student> studentThreadLocal = new ThreadLocal<Student>();

    public void run() {

        String currentName = Thread.currentThread().getName();
        System.out.println(currentName + "is running....");

        Random random = new Random();
        int age = random.nextInt(100);

        System.out.println(currentName + "is set age " + age);

        /*   Student student = studentThreadLocal.get();
        if (student == null) {
            student = new Student();
        }*/
        Student student = getStudent();
        student.setAge(age);
        studentThreadLocal.set(student);

        System.out.println(currentName + "is get first age " + student.getAge());
        try {
            Thread.sleep(500);
        } catch (InterruptedException e) {
            e.printStackTrace();  //To change body of catch statement use File | Settings | File Templates.
        }
        System.out.println(currentName + "is get first age " + student.getAge());
    }

    /**
     * ?????????????????bnew?????????????student???????????¨°?????
     *
     * @return
     */
    private Student getStudent() {
        Student studen = studentThreadLocal.get();
        if (null == studen) {
            studen = new Student();
            studentThreadLocal.set(studen);
        }
        return studen;
    }

    public static void main(String args[]) {
        TheadLocalTest syn = new TheadLocalTest();

        Thread t1 = new Thread(syn, "Thread 1");
        Thread t2 = new Thread(syn, "Thread 2");
        t1.start();
        t2.start();
    }

}
